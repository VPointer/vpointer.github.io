<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="Y0-gFMBzGnbrueUrh8PjkmnvCGItjob2oR3HjG9SVnE">
  <meta name="msvalidate.01" content="97A49017D4D536B99438C4EE0E9FBA3F">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.zuiqiangiron.xyz","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="MyBatis笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis笔记">
<meta property="og:url" content="https://www.zuiqiangiron.xyz/2020/07/08/MyBatis%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="嘴强黑铁">
<meta property="og:description" content="MyBatis笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-07-08T11:42:22.000Z">
<meta property="article:modified_time" content="2020-07-08T11:42:56.732Z">
<meta property="article:author" content="嘴强黑铁">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.zuiqiangiron.xyz/2020/07/08/MyBatis%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MyBatis笔记 | 嘴强黑铁</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161480657-1"></script>
    <script pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-161480657-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">嘴强黑铁</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">天下事以难而废者十之一，以惰而废者十之九</h1>
      
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="search-pop-overlay">
  <div class="popup search-popup">
      <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

  </div>
</div>

  </div>
</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.zuiqiangiron.xyz/2020/07/08/MyBatis%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="嘴强黑铁">
      <meta itemprop="description" content="一顿操作猛如虎">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嘴强黑铁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          MyBatis笔记
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-08 19:42:22 / 修改时间：19:42:56" itemprop="dateCreated datePublished" datetime="2020-07-08T19:42:22+08:00">2020-07-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/Java/MyBatis/" itemprop="url" rel="index"><span itemprop="name">MyBatis</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/07/08/MyBatis%E7%AC%94%E8%AE%B0/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/07/08/MyBatis笔记/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>MyBatis笔记</p>
</blockquote>
<a id="more"></a>
<h1 id="mybatis简介">MyBatis简介</h1>
<p>它是一个持久化层的框架。</p>
<p>Hibernate其实更加强大，但为什么现在越来越多的大企业不用它呢？因为Hibernate不能定制SQL，这会导致有些查询非常低效。它有种"反模式"的嫌疑。</p>
<p>MyBatis最大的好处就是，你可以通过配置文件方式指定MyBatis要运行的SQL语句，而其他方面，比如获取连接，获取PreparedStatement，预编译参数，执行SQL，封装结果等依然由框架来执行。换句话说，MyBatis将重要步骤抽取出来交由开发者通过配置文件自行定制，其他步骤自动化，而不是一个黑箱。</p>
<p>MyBatis底层其实就是对原生JDBC的简单封装。</p>
<h1 id="mybatis入门操作">MyBatis入门操作</h1>
<ol type="1">
<li><p>导入MyBatis和MySQL的jar包。</p></li>
<li><p>写配置文件</p>
<p>假设我有如下的代码：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learning.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String empname;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 还有构造器，get/set方法等没有列出，节约篇幅</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.learning.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.learning.pojo.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeDao</span> </span>&#123;</span><br><span class="line">    <span class="function">Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>[第1个配置文件: 全局配置文件]</strong>，指导mybatis如何正确运行：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入外部配置文件，这里是JDBC配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"dbconf.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--固定写法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--修改这里面的内容既可--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driverClassName&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.user&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置SQL映射文件，可以有多个--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mybatis/EmployeeDao.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p></li>
<li><p><strong>[第2个配置文件: SQL映射文件]</strong>，配置每一个方法都如何向数据库发SQL，这类配置文件可以有多个：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--修改namespace属性，将其设置为接口的全类名，相当于告诉mybatis这个配置文件是实现哪个接口的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.learning.dao.EmployeeDao"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--修改id为方法名, resultType是方法返回值的类型(查询操作必须指定),</span></span><br><span class="line"><span class="comment">    相当于告诉mybatis下面的sql语句相当于是调用接口中的哪个方法--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--只有查询需要返回值，增删改都会自动装配一个int或者boolean作为返回值(视你的方法决定)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpById"</span> <span class="attr">resultType</span>=<span class="string">"com.learning.pojo.Employee"</span>&gt;</span></span><br><span class="line">        select * from t_employee where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertEmployee"</span>&gt;</span></span><br><span class="line">        insert into t_employee(empname, gender, email) values(#&#123;empname&#125;, #&#123;gender&#125;,#&#123;email&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateEmployee"</span>&gt;</span></span><br><span class="line">        update t_employee set empname=#&#123;empname&#125;, gender=#&#123;gender&#125;, email=#&#123;email&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteEmployee"</span>&gt;</span></span><br><span class="line">        delete from t_employee where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>上述步骤包括：</p>
<ul>
<li>设置<code>mapper</code>的<code>namespace</code>属性，告诉mybatis，这个<code>mapper</code>是实现哪个Dao接口的；</li>
<li>设置<code>select</code>的<code>id</code>属性，告诉本<code>select</code>对应于接口中的哪个方法，<code>resultType</code>表示该方法的返回类型</li>
<li>修改SQL语句</li>
</ul></li>
<li><p>在全局配置文件中注册第2个配置文件，也就是在全局配置文件中的mappers标签中添加第2个配置文件</p></li>
</ul></li>
<li><p>测试</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learning.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.learning.dao.EmployeeDao;</span><br><span class="line"><span class="keyword">import</span> com.learning.pojo.Employee;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 第1步，根据全局配置文件创建一个SqlSessionFactory对象</span></span><br><span class="line">        String resource = <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第2步，从SqlSessionFactory对象中创建一个SqlSession对象，它就表示和数据库的会话Session</span></span><br><span class="line">        <span class="keyword">try</span> (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">						 <span class="comment">// mapper其实是MyBatis自动创建的Dao的动态代理对象，</span></span><br><span class="line">            EmployeeDao mapper = session.getMapper(EmployeeDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="comment">// ---------------------- 以上代码都是固定步骤 -----------------------------------------</span></span><br><span class="line">            <span class="comment">// 以下代码才是你的应用逻辑代码</span></span><br><span class="line">            Employee employee = mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到，一共两个步骤：</p>
<ul>
<li>第1步，根据全局配置文件创建一个<code>SqlSessionFactory</code>对象</li>
<li>第2步，从<code>SqlSessionFactory</code>对象中创建一个<code>SqlSession</code>对象，它就表示和数据库的会话Session</li>
</ul>
<p>代码中分割线之上的都是固定步骤，剩下的才是你的应用逻辑代码。</p></li>
</ol>
<h1 id="sql映射文件">SQL映射文件</h1>
<p>全局配置文件没什么好说的，基本就是上述的格式，而且后面连连接池、事务管理都不用上述的配置，所以详细说一说SQL映射文件。</p>
<h2 id="usegeneratedkeys和keyproperty属性">useGeneratedKeys和keyProperty属性</h2>
<p>它们仅对<code>&lt;insert&gt;</code>和<code>&lt;update&gt;</code>标签有用。</p>
<p><code>useGeneratedKeys="true"</code>表示执行sql语句之后查询数据库创建的<strong>自增主键</strong>的值，<code>keyProperty="id"</code>属性表示将查到的自增主键赋值给传入的bean的<code>id</code>属性。</p>
<p>这两个<strong>属性</strong>不一定配套使用，且这两个<strong>标签</strong>内部还可以嵌套<code>&lt;select&gt;</code>标签，用它来<strong>提前(<code>BEFORE</code>属性)</strong>或者<strong>稍后(<code>AFTER</code>属性)</strong>执行某些查询语句并结合<code>keyProperty</code>属性给传入的bean赋值。</p>
<h2 id="参数传递">参数传递</h2>
<p>以下参数指的是dao方法的参数列表，以及它们在配置文件中该如何取出。</p>
<ul>
<li><p><strong>形参列表只有单个参数</strong>：可以接收基本类型，对象类型，集合类型的值。这种情况MyBatis可直接使用这个参数，不需要经过任何处理，方法中的参数名和配置文件中的参数名甚至可以不一样；</p></li>
<li><p><strong>形参列表有多个参数</strong>：任意多个参数都会被MyBatis重新包装成一个<code>Map</code>对象传入代理对象中，形参列表中第1个参数对应的key是<code>0</code>或者<code>"param1"</code>，第2个参数对应的key是<code>1</code>或者<code>"param2"</code>，以此类推，对应的value就是参数的值，例如：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Employee getEmpByIdAndName(Integer id, String name);</span><br><span class="line"></span><br><span class="line">// -----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdAndName"</span> <span class="attr">resultType</span>=<span class="string">"com.learning.pojo.Employee"</span>&gt;</span></span><br><span class="line">    select * from t_employee where id=#&#123;param1&#125;, name=#&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 或者 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdAndName"</span> <span class="attr">resultType</span>=<span class="string">"com.learning.pojo.Employee"</span>&gt;</span></span><br><span class="line">    select * from t_employee where id=#&#123;0&#125;, name=#&#123;1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p></li>
<li><p><strong>命名参数</strong>：如果形参列表有多个参数，可以在方法的参数列表中使用<code>@Param</code>注解给形参自定义一个名字(一般就是形参名)，然后MyBatis在将参数封装到<code>Map</code>对象中时，就不会再按上述规则命名key，而是按照注解中你传入的参数来命名key，如下：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Employee getEmpByIdAndName(@Param("id") Integer id, @Param("name") String name);</span><br><span class="line"></span><br><span class="line">// -----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdAndName"</span> <span class="attr">resultType</span>=<span class="string">"com.learning.pojo.Employee"</span>&gt;</span></span><br><span class="line">    select * from t_employee where id=#&#123;id&#125;, name=#&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>如果参数是POJO：直接穿这个参数既可</p></li>
<li><p>使用Map作为参数：MaBatis将参数列表封装到一个Map对象中进行传递，所以，我们也可以直接使用一个Map对象作为形参。</p></li>
</ul>
<h2 id="与的区别"><code>#{}</code>与<code>${}</code>的区别</h2>
<p>在SQL映射文件中，给SQL传值可以有两种方式，<code>#{}</code>或<code>${}</code>，它们的区别如下：</p>
<ul>
<li><code>#{}</code>使用的是参数预编译的方式，参数的位置都用<code>?</code>代替，具体的值都是后来预编译进去的。</li>
<li><code>${}</code>使用的并不是预编译，而是将参数直接和SQL语句拼串。</li>
</ul>
<p>显然<code>#{}</code>方式更好，它更安全，不会有SQL注入的问题。</p>
<p>而为什么MyBatis要支持两种传值方式呢？因为预编译的方式只支持参数位置的赋值，如果你想传入一个表名，那就只能用<code>${}</code>。分表操作的时候就需要<code>${}</code>，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="comment">#&#123;dest_table&#125; where a=#&#123;a&#125;, b=#&#123;b&#125;  # 报错！表名不支持预编译！</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> $&#123;dest_table&#125; <span class="keyword">where</span> a=<span class="comment">#&#123;a&#125;, b=#&#123;b&#125;  # 正确</span></span><br></pre></td></tr></table></figure>
<p>一句话总结：一般都使用<code>#{}</code>，需要在预编译不支持的位置取值时才使用<code>${}</code>.</p>
<h2 id="返回一个list对象">返回一个List对象</h2>
<p>并没有什么特殊的配置，配置跟查询单行记录一样：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public List<span class="tag">&lt;<span class="name">Employee</span>&gt;</span> getAllEmps(); // Dao接口中的声明</span><br><span class="line"></span><br><span class="line">// -------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAllEmps"</span> <span class="attr">resultType</span>=<span class="string">"com.learning.pojo.Employee"</span>&gt;</span> <span class="comment">&lt;!-- resultType依然是全类名 --&gt;</span></span><br><span class="line">    select * from t_employee</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="返回一个map对象">返回一个Map对象</h2>
<p><strong>如果查询的是单行记录</strong>，配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> getEmpByIdReturnWithMap(Integer id); // Dao接口中的声明</span><br><span class="line"></span><br><span class="line">// -------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByIdReturnWithMap"</span> <span class="attr">resultType</span>=<span class="string">"map"</span>&gt;</span> <span class="comment">&lt;!-- map是MyBatis为Map起的别名--&gt;</span></span><br><span class="line">    select * from t_employee where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ol type="1">
<li><code>resultType</code>属性需要设置为<code>"map"</code>，这个值是MyBatis为<code>Map</code>类型起的别名</li>
<li>它会把列名作为结果map的key，列的值作为结果map的value.</li>
</ol>
<p><strong>如果查询的是多行记录</strong>，首先需要指定将哪个属性作为key，然后MyBatis将会把查询到的对象将作为相应的value。它的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@MapKey("id)   // 需要使用注解！</span><br><span class="line">public Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Employee</span>&gt;</span> getAllEmpReturnWithMap(); // Dao接口中的声明</span><br><span class="line"></span><br><span class="line">// -------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAllEmpReturnWithMap"</span> <span class="attr">resultType</span>=<span class="string">"com.learning.pojo.Employee"</span>&gt;</span> <span class="comment">&lt;!-- 不再是map了！--&gt;</span></span><br><span class="line">    select * from t_employee</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ol type="1">
<li>如果是多行查询且想返回一个<code>Map</code>对象，首先，通过@MapKey注解指定将哪个属性作为key；</li>
<li><code>resultType</code>属性的值不能再是<code>"map"</code>，而应该是全类名，如果依然使用<code>"map"</code>的话，查询到的结果将会被重新封装成一个Map对象，作为结果map中value的值，就跟查询单行记录的情况一样。</li>
</ol>
<h2 id="自定义结果集-resultmap标签">自定义结果集: &lt;resultMap&gt;标签</h2>
<p>MyBatis会自动将查询结果封装成一个bean，但默认的前提是表的列名必须和POJO的属性名一致(不区分大小写)，比如列名叫<code>nAme</code>(或者<code>name</code>,<code>Name</code>等都可以)，那么要想使用默认的封装规则，属性名就必须是<code>name</code>，否则封装失败。</p>
<p>如果列名和属性名不一致，那么有以下几种解决办法：</p>
<ol type="1">
<li>如果列名仅仅是在驼峰命名法中间加入了下划线，那么可以<strong>在全局配置文件中启用驼峰命名法</strong></li>
<li>如果列名起的很随性，那么可以在SQL语句中使用别名；</li>
</ol>
<p>但还有一种功能更强大的方法：使用<strong>自定义结果集</strong>。也就是<strong>自定义列名和属性的映射规则</strong>，需要使用<code>&lt;resultMap&gt;</code>标签:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用resultMap属性来告诉MyBatis使用自定义的映射--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getCatById"</span> <span class="attr">resultMap</span>=<span class="string">"mycat"</span>&gt;</span></span><br><span class="line">    select * from t_cat where cid=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"mycat"</span> <span class="attr">type</span>=<span class="string">"com.learning.pojo.Cat"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义主键列的映射规则！--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--column表示列名，property表示属性名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"cid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--定义其他列的映射规则--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"cname"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"cage"</span> <span class="attr">property</span>=<span class="string">"age"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"cgender"</span> <span class="attr">property</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="联合查询">联合查询</h2>
<p>这里主要涉及两个标签：<code>&lt;association&gt;</code>标签和<code>&lt;collection&gt;</code>标签。</p>
<h3 id="association标签">&lt;association&gt;标签</h3>
<p>如果属性也是一个自定义类型，可以在<code>resultMap</code>标签中使用<code>&lt;association&gt;</code>标签。</p>
<p>例如有如下两个类，一个钥匙类<code>Key</code>，一个锁类<code>Lock</code>，我们先演示如何根据<code>id</code>查找到<code>Key</code>对象，并同时装配其中的<code>Lock</code>对象属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learning.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Key</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String keyName;</span><br><span class="line">    <span class="keyword">private</span> Lock lock;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 没有显示构造器，get/set方法等</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.learning.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String lockName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Key&gt; keys;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 没有显示构造器，get/set方法等</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的数据库表如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> test_mybatis.t_lock</span><br><span class="line">(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span> auto_increment</span><br><span class="line">		primary <span class="keyword">key</span>,</span><br><span class="line">	lockname <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> test_mybatis.t_key</span><br><span class="line">(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span> auto_increment</span><br><span class="line">		primary <span class="keyword">key</span>,</span><br><span class="line">	keyname <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="literal">null</span>,</span><br><span class="line">	lockid <span class="built_in">int</span> <span class="literal">null</span>,</span><br><span class="line">	<span class="keyword">constraint</span> fk_key_lock</span><br><span class="line">		<span class="keyword">foreign</span> <span class="keyword">key</span> (lockid) <span class="keyword">references</span> test_mybatis.t_lock (<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>那么当查询<code>t_key</code>表时，可以如下设置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// KeyDao.java</span><br><span class="line">Key getKeyById(Integer id);</span><br><span class="line"></span><br><span class="line">// -----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- KeyDao.xml --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--联合查询--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用resultMap属性--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getKeyById"</span> <span class="attr">resultMap</span>=<span class="string">"myKey"</span>&gt;</span></span><br><span class="line">    select t_key.*, tl.lockname</span><br><span class="line">    from t_key</span><br><span class="line">             left join t_lock tl on t_key.lockid = tl.id</span><br><span class="line">    where t_key.id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--设置type属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"myKey"</span> <span class="attr">type</span>=<span class="string">"com.learning.pojo.Key"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"keyname"</span> <span class="attr">property</span>=<span class="string">"keyName"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--使用association来给内部自定义属性赋值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"lock"</span> <span class="attr">javaType</span>=<span class="string">"com.learning.pojo.Lock"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"lockid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"lockname"</span> <span class="attr">property</span>=<span class="string">"lockName"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--本来Lock还有个keys属性，这里这个属性置为null--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 也可以将上述的association替换成如下形式，但并不推荐！</span></span><br><span class="line"><span class="comment">    &lt;result column="lockid" property="lock.id"/&gt;</span></span><br><span class="line"><span class="comment">    &lt;result column="lockname" property="lock.lockName"/&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述展示了两种给内部自定义属性赋值的方法，但MyBatis更推荐使用<code>&lt;association&gt;</code>标签。</p>
<h3 id="collection标签">&lt;collection&gt;标签</h3>
<p>我们看到Lock类中还有个keys属性，它是一个集合。</p>
<p>下面演示<code>1对n关系</code>该如何查找，并将查找结果赋值给类中的集合属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// LockDao.java</span><br><span class="line">Lock getLockById(Integer id);</span><br><span class="line"></span><br><span class="line">// -------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--LockDao.xml--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getLockById"</span> <span class="attr">resultMap</span>=<span class="string">"myLockMapping"</span>&gt;</span></span><br><span class="line">    select t_lock.id lockid, t_lock.lockname, tk.id keyid, tk.keyname</span><br><span class="line">    from t_lock</span><br><span class="line">             left join t_key tk on t_lock.id = tk.lockid</span><br><span class="line">    where t_lock.id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"myLockMapping"</span> <span class="attr">type</span>=<span class="string">"com.learning.pojo.Lock"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"lockid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"lockname"</span> <span class="attr">property</span>=<span class="string">"lockName"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过collection标签给集合属性赋值--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--需要使用ofType属性来设置集合中元素的类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"keys"</span> <span class="attr">ofType</span>=<span class="string">"com.learning.pojo.Key"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--依然是映射，表示该如何给元素赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"keyid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"keyname"</span> <span class="attr">property</span>=<span class="string">"keyName"</span>/&gt;</span></span><br><span class="line">				 <span class="comment">&lt;!--不要再设置Key的Lock属性！否则无限递归--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除了之前所讲到的设置外，使用<code>&lt;collection&gt;</code>标签需要设置<code>ofType</code>属性的值，它表示集合中元素的类型。</p>
<h2 id="分步查询一般不用这种方式">分步查询(一般不用这种方式)</h2>
<p><strong>本方法了解既可！</strong></p>
<p>前面使用的联合查询其实可以拆成多个查询，最终结果可以根据这多个查询组合起来。MyBatis也支持这种方式，此时需要使用<code>&lt;association&gt;</code>标签中的<code>select</code>属性，并且相应的Dao里面还要加上简单查询的接口。</p>
<p>例如，以下是第2种查Key的方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// KeyDao.java</span><br><span class="line">Key getKeyByIdSimple(Integer id);</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!---------------------------------------------华丽的分割线--------------------------------------------------&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- KeyDao.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getKeyByIdSimple"</span> <span class="attr">resultMap</span>=<span class="string">"myKeySimple"</span>&gt;</span></span><br><span class="line">    select * from t_key where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"myKeySimple"</span> <span class="attr">type</span>=<span class="string">"com.learning.pojo.Key"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"keyname"</span> <span class="attr">property</span>=<span class="string">"keyName"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--使用分布查询, select是全类名+方法名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"lock"</span> <span class="attr">select</span>=<span class="string">"com.learning.dao.LockDao.getLockByIdSimple"</span> <span class="attr">column</span>=<span class="string">"lockid"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!---------------------------------------------华丽的分割线--------------------------------------------------&gt;</span></span><br><span class="line"></span><br><span class="line">// LockDao.java</span><br><span class="line">Lock getLockByIdSimple(Integer id);</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!---------------------------------------------华丽的分割线--------------------------------------------------&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- LockDao.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getLockByIdSimple"</span> <span class="attr">resultType</span>=<span class="string">"com.learning.pojo.Lock"</span>&gt;</span></span><br><span class="line">    select * from t_lock where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ol type="1">
<li>在<code>&lt;association&gt;</code>标签中使用<code>select</code>属性即是分步查询，其中的<code>column</code>表示将第一步查询结果中的哪一列作为第二步查询的参数。</li>
<li>此时，调用<code>KeyDao</code>中的<code>getKeyByIdSimple()</code>方法将会<strong>立刻</strong>向数据库发两次请求。</li>
</ol>
<p>以下是第2种查Lock的方法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// KeyDao.java</span><br><span class="line">List<span class="tag">&lt;<span class="name">Key</span>&gt;</span> getKeysByLockId(Integer id);</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!---------------------------------------------华丽的分割线--------------------------------------------------&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- KeyDao.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getKeysByLockId"</span> <span class="attr">resultType</span>=<span class="string">"com.learning.pojo.Key"</span>&gt;</span></span><br><span class="line">    select * from t_key where lockid=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!---------------------------------------------华丽的分割线--------------------------------------------------&gt;</span></span><br><span class="line"></span><br><span class="line">// LockDao.java</span><br><span class="line">Lock getLockByIdSimple(Integer id);</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!---------------------------------------------华丽的分割线--------------------------------------------------&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getLockByIdSimple"</span> <span class="attr">resultMap</span>=<span class="string">"getLockByIdSimpleMapping"</span>&gt;</span></span><br><span class="line">    select * from t_lock where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"getLockByIdSimpleMapping"</span> <span class="attr">type</span>=<span class="string">"com.learning.pojo.Lock"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"lockid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"lockname"</span> <span class="attr">property</span>=<span class="string">"lockName"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过collection标签给集合属性赋值--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--需要使用ofType属性来设置集合中元素的类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"keys"</span> <span class="attr">select</span>=<span class="string">"com.learning.dao.KeyDao.getKeysByLockId"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果调用的方法有多个值，也可以在<code>&lt;association&gt;</code>和<code>&lt;collection&gt;</code>标签中的<code>column</code>属性中使用大括号赋值：<code>{key1=列名1, key2=列名2}</code></p>
<h3 id="懒加载与按需查询">懒加载与按需查询</h3>
<p>如果你像上述那样写分步查询，那么，如果你只是会用到<code>Key</code>对象的<code>keyName</code>属性，上述代码也会查询<code>Key</code>对象的<code>lock</code>属性，这就降低了数据库的性能。</p>
<p>使用按需查询，则可以避免上述的性能浪费，它只会在你用到某个属性的时候，再去发SQL语句查询。换句话说，开启了这个功能，如果不去访问对象的任何属性，它甚至都不会发SQL来给这个对象赋值。</p>
<p>在<strong>全局配置文件</strong>中添加如下设置既可开启此功能：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span> <span class="comment">&lt;!-- 开启懒加载模式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span> <span class="comment">&lt;!-- 开启侵入式懒加载 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然，如果你想对某个方法禁用按需加载，可以在<code>&lt;association&gt;</code>和<code>&lt;collection&gt;</code>标签中使用<code>fetchType</code>属性。</p>
<h3 id="一般作法">一般作法</h3>
<p>其实并不推荐使用分步查询，因为分步一多，数据库性能就下降。</p>
<p>一般推荐在Dao中写两个方法：</p>
<ol type="1">
<li>一个简单查询，得到某个类的简单信息；</li>
<li>一个联合查询，而不是分步查询。</li>
</ol>
<h1 id="动态sql">动态SQL</h1>
<p>这里才正式体现了MyBatis的强大之处，它简化了SQL动态拼串的操作。</p>
<p>MyBatis使用的是OGNL表达式，它有两个默认参数：</p>
<ul>
<li><code>_parameter</code>：表示传入的参数，如果是单个参数，那<code>_parameter</code>就是那个参数的值；如果是多个参数，那<code>_parameter</code>就是所有参数组成的<code>Map</code>对象；</li>
<li><code>_databaseId</code>：用于数据库移植。</li>
</ul>
<p>为了演示MyBatis的动态SQL，这里使用如下类来演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.learning.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String className;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造器，get/set方法等未展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上这个类对应于如下这张表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_mybatis.t_teacher</span><br><span class="line">(</span><br><span class="line">	tid <span class="built_in">int</span> auto_increment</span><br><span class="line">		primary <span class="keyword">key</span>,</span><br><span class="line">	teacher_name <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="literal">null</span>,</span><br><span class="line">	class_name <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="literal">null</span>,</span><br><span class="line">	home_address <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="literal">null</span>,</span><br><span class="line">	birth <span class="built_in">date</span> <span class="literal">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>由于列名和属性名不同，首先在<code>TeacherDao.xml</code>配置如下映射:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"teacherMapping"</span> <span class="attr">type</span>=<span class="string">"com.learning.pojo.Teacher"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"tid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"teacher_name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"class_name"</span> <span class="attr">property</span>=<span class="string">"className"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"home_address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birth"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="实验1">实验1</h2>
<p>这是一个关于查询的实验。</p>
<p>如果<code>TeacherDao</code>中有这样一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按照teacher中非空字段的值进行查询</span></span><br><span class="line"><span class="function">List&lt;Teacher&gt; <span class="title">getTeachersByCondition</span><span class="params">(Teacher teacher)</span></span>;</span><br></pre></td></tr></table></figure>
<p>且你有这样的一个测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisTest</span> </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String resource = <span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTeacherDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">            TeacherDao dao = session.getMapper(TeacherDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">            Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">            t.setId(<span class="number">1</span>);</span><br><span class="line">            t.setName(<span class="string">"%a%"</span>);  <span class="comment">// 名字使用模糊查询</span></span><br><span class="line">            System.out.println(dao.getTeachersByCondition(t));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么此时，<code>TeacherDao.xml</code>需要如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getTeachersByCondition"</span> <span class="attr">resultMap</span>=<span class="string">"teacherMapping"</span>&gt;</span></span><br><span class="line">    select * from t_teacher</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">            and tid &gt; #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null and !name.equals('')"</span>&gt;</span></span><br><span class="line">            and teacher_name like #&#123;name&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"birthday != null"</span>&gt;</span></span><br><span class="line">            and birth <span class="symbol">&amp;lt;</span> #&#123;birthday&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;trim prefix="where" prefixOverrides="and" suffix="" suffixOverrides="and"&gt;</span></span><br><span class="line"><span class="comment">        &lt;if test="id!=null"&gt;</span></span><br><span class="line"><span class="comment">            and tid &gt; #&#123;id&#125;</span></span><br><span class="line"><span class="comment">        &lt;/if&gt;</span></span><br><span class="line"><span class="comment">        &lt;if test="name != null and !name.equals('')"&gt;</span></span><br><span class="line"><span class="comment">            and teacher_name like #&#123;name&#125;</span></span><br><span class="line"><span class="comment">        &lt;/if&gt;</span></span><br><span class="line"><span class="comment">        &lt;if test="birthday != null"&gt;</span></span><br><span class="line"><span class="comment">            and birth &amp;lt; #&#123;birthday&#125;</span></span><br><span class="line"><span class="comment">        &lt;/if&gt;</span></span><br><span class="line"><span class="comment">    &lt;/trim&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    &lt;where&gt;</span></span><br><span class="line"><span class="comment">        &lt;choose&gt;</span></span><br><span class="line"><span class="comment">            &lt;when test="id != null"&gt;</span></span><br><span class="line"><span class="comment">                tid=#&#123;id&#125;</span></span><br><span class="line"><span class="comment">            &lt;/when&gt;</span></span><br><span class="line"><span class="comment">            &lt;when test="name != null and !name.equals('')"&gt;</span></span><br><span class="line"><span class="comment">                teacher_name=#&#123;name&#125;</span></span><br><span class="line"><span class="comment">            &lt;/when&gt;</span></span><br><span class="line"><span class="comment">            &lt;when test="birthday != null"&gt;</span></span><br><span class="line"><span class="comment">                birth &amp;lt; #&#123;birthday&#125;</span></span><br><span class="line"><span class="comment">            &lt;/when&gt;</span></span><br><span class="line"><span class="comment">            &lt;otherwise&gt;</span></span><br><span class="line"><span class="comment">                1=1</span></span><br><span class="line"><span class="comment">            &lt;/otherwise&gt;</span></span><br><span class="line"><span class="comment">        &lt;/choose&gt;</span></span><br><span class="line"><span class="comment">    &lt;/where&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明：上述使用了5个标签</p>
<ol type="1">
<li><code>&lt;where&gt;</code>标签用于替代SQL语句中的<code>where</code>关键字，它会自动去除拼接得到的SQL中最前面的<code>"and"</code>字符串，但<code>&lt;where&gt;</code>标签内部得到的结果字符串不能为空，否则报错；</li>
<li><code>&lt;if&gt;</code>标签用于对传入的参数进行判断，标签内部的值是判断通过时向SQL拼接的字符串；</li>
<li><code>&lt;trim&gt;</code>标签则用于修剪字符串，它一共有4个属性：
<ul>
<li><code>prefix</code>属性用于在生成的字符串最前方添加一个字符串；</li>
<li><code>prefixOverrides</code>属性用于在生成的字符串最前方去掉字符串；</li>
<li><code>suffix</code>属性用于在生成的字符串最后方添加一个字符串；</li>
<li><code>suffixOverrides</code>属性用于在生成的字符串最后方去掉字符串。</li>
</ul></li>
<li><code>&lt;choose&gt;</code>标签表示从其中选择一个，相当于<code>switch</code></li>
</ol>
<h2 id="实验2">实验2</h2>
<p>依然是关于查询的实验。</p>
<p>如果<code>TeacherDao</code>中有这样一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按照teacher中非空字段的值进行查询</span></span><br><span class="line"><span class="function">List&lt;Teacher&gt; <span class="title">getTeachersByCondition</span><span class="params">(Teacher teacher)</span></span>;</span><br></pre></td></tr></table></figure>
<p>那么此时需要使用<code>&lt;foreach&gt;</code>标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getTeachersByIds"</span> <span class="attr">resultMap</span>=<span class="string">"teacherMapping"</span>&gt;</span></span><br><span class="line">    select * from t_teacher where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"id_item"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;id_item&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;foreach&gt;</code>标签还有一个<code>index</code>属性：</p>
<ul>
<li>当集合是<code>List</code>时，<code>index</code>记录的是索引值；</li>
<li>当集合是<code>Map</code>时，<code>index</code>记录的是key的值。</li>
</ul>
<h2 id="实验3">实验3</h2>
<p>这是一个关于更新的实验。</p>
<p>如果<code>TeacherDao</code>中有这样一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据teacher中非空字段进行更新，请确保teacher的id不为空。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateTeacher</span><span class="params">(Teacher teacher)</span></span>;</span><br></pre></td></tr></table></figure>
<p>那么此时需要使用<code>&lt;set&gt;</code>标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateTeacher"</span>&gt;</span></span><br><span class="line">    update t_teacher</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null and !name.equals(<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>)"</span>&gt;</span></span><br><span class="line">            teacher_name = #&#123;name&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"className != null and !className.equals(<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>)"</span>&gt;</span></span><br><span class="line">            class_name = #&#123;className&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"address != null and !address.equals(<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>)"</span>&gt;</span></span><br><span class="line">            home_address = #&#123;address&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"birthday != null"</span>&gt;</span></span><br><span class="line">            birth = #&#123;birthday&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        tid=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;set&gt;</code>标签会自动删掉最后的逗号<code>,</code>.</p>
<h2 id="实验4抽取可重用sql">实验4：抽取可重用SQL</h2>
<p>改造实验1的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"selectSQL"</span>&gt;</span>select * from t_teacher<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getTeachersByCondition"</span> <span class="attr">resultMap</span>=<span class="string">"teacherMapping"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"selectSQL"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">            and tid &gt; #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null and !name.equals('')"</span>&gt;</span></span><br><span class="line">            and teacher_name like #&#123;name&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"birthday != null"</span>&gt;</span></span><br><span class="line">            and birth <span class="symbol">&amp;lt;</span> #&#123;birthday&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="mybatis缓存">MyBatis缓存</h1>
<p>MyBatis将查到的一些数据保存到<code>Map</code>中。</p>
<p>MaBatis的缓存分两级，两个级别的缓存用的都是<code>Map</code>。</p>
<h2 id="一级缓存">一级缓存</h2>
<p>线程级别的缓存，SqlSession级别的缓存，也叫本地缓存，默认是开启状态。</p>
<p>只要之前查询过的数据，MyBatis就会保存在一个<code>Map</code>中，下次用直接取，而不是查数据库。</p>
<h3 id="一级缓存失效">一级缓存失效</h3>
<p>有这几种情况会使一级缓存失效：</p>
<ol type="1">
<li>一级缓存只是SqlSession级别的缓存，不同的SqlSession不共用缓存；</li>
<li>同一方法不同参数也会重新发SQL；</li>
<li><strong>每一次增删改操作，都会清空本SqlSession的缓存以及二级缓存</strong>。</li>
<li>手动清空缓存：<code>sqlSession.clearCache()</code>，清理的是一级缓存；</li>
</ol>
<h2 id="二级缓存">二级缓存</h2>
<p>全局范围内的缓存，其他SqlSession也能使用这个缓存。</p>
<p>二级缓存默认不开启，需要手动配置；</p>
<p>MyBatis提供二级缓存的接口以及实现，缓存实现要求POJO实现<code>Serializable</code>接口；</p>
<p><strong>二级缓存在SqlSession关闭或提交之后才会生效</strong>。</p>
<p>每一个Dao都有自己的二级缓存，并不共享！</p>
<h3 id="使用方法">使用方法</h3>
<ol type="1">
<li><p>全局配置文件中添加一个设置：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>在需要使用二级缓存的Dao.xml文件中加入<code>&lt;cache&gt;</code>标签：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">.....</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">cache</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>里面不用写值，直接一个空<code>&lt;cache&gt;</code>标签既可。当然它还有一些属性可以设置。</p></li>
<li><p>给需要二级缓存的POJO实现<code>Serializable</code>接口</p></li>
</ol>
<h3 id="查询顺序">查询顺序</h3>
<p><strong>任何时候，MyBatis都是先看二级缓存</strong>，如果二级缓存中有相应的数据，则直接从二级缓存中取，没有则去一级缓存查找，如果依然找不到，才最后去查数据库。</p>
<h2 id="标签中关于缓存的属性">标签中关于缓存的属性</h2>
<p>其实<strong>查询标签</strong><code>&lt;select&gt;</code>有一个<code>useCache</code>属性，它的默认值为<code>true</code>，表示使用二级缓存。</p>
<p><strong>增删改查</strong>的标签中还有一个<code>flushCache</code>属性：</p>
<ul>
<li>对于增删改，它的默认值为<code>true</code>，表示每一次增删改都同时清空一级和二级缓存；</li>
<li>对与查，它的默认值是<code>false</code>。</li>
</ul>
<h2 id="使用第三方缓存">使用第三方缓存</h2>
<p>MyBatis开放了一个<code>Cache</code>接口，可以用它来自定义<strong>二级缓存。</strong></p>
<p>具体的使用步骤如下：</p>
<ol type="1">
<li>导入第三方缓存库的各种jar；</li>
<li>编写第三方缓存的配置文件</li>
<li>在上述的<code>&lt;cache&gt;</code>标签中添加一个<code>type</code>属性，它的值就是第三方缓存实现类的全类名。</li>
</ol>
<p>对于某些第三方缓存，即是你不实现<code>Serializable</code>接口，也可以缓存(例如ehcache)。</p>
<h1 id="与spring的整合">与Spring的整合</h1>
<ol type="1">
<li><p>需要使用到一个mybatis-spring-x.x.x.jar的整合包；</p></li>
<li><p>MyBatis的<strong>全局配置</strong>文件中值保留<code>&lt;settings&gt;</code>中的内容，其他都可以删掉；</p></li>
<li><p>在Spring的配置文件中添加如下内容：</p>
<p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置SqlSessionFactoryBean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"sqlSessionFactoryBean"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--指定文件位置--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis/mybatis-config.xml"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--引用配置在Spring中的DataSource--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"ds"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--配置SQL映射文件的位置--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis/mappers/*.xml"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--将每个Dao的实现加入到容器中--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--配置dao包所在的位置--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.learning.dao"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>经过上述配置就可以直接在<code>Service</code>中<code>@Autowired</code>相应的<code>Dao</code>实例。</p></li>
</ol>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>嘴强黑铁
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.zuiqiangiron.xyz/2020/07/08/MyBatis%E7%AC%94%E8%AE%B0/" title="MyBatis笔记">https://www.zuiqiangiron.xyz/2020/07/08/MyBatis笔记/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/MyBatis/" rel="tag"># MyBatis</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/07/06/Spring%20MVC%E7%AC%94%E8%AE%B0/" rel="prev" title="Spring MVC笔记">
      <i class="fa fa-chevron-left"></i> Spring MVC笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/11/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8Redis/" rel="next" title="Spring Boot中使用Redis">
      Spring Boot中使用Redis <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#mybatis简介"><span class="nav-number">1.</span> <span class="nav-text">MyBatis简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mybatis入门操作"><span class="nav-number">2.</span> <span class="nav-text">MyBatis入门操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sql映射文件"><span class="nav-number">3.</span> <span class="nav-text">SQL映射文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#usegeneratedkeys和keyproperty属性"><span class="nav-number">3.1.</span> <span class="nav-text">useGeneratedKeys和keyProperty属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数传递"><span class="nav-number">3.2.</span> <span class="nav-text">参数传递</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#与的区别"><span class="nav-number">3.3.</span> <span class="nav-text">#{}与${}的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#返回一个list对象"><span class="nav-number">3.4.</span> <span class="nav-text">返回一个List对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#返回一个map对象"><span class="nav-number">3.5.</span> <span class="nav-text">返回一个Map对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义结果集-resultmap标签"><span class="nav-number">3.6.</span> <span class="nav-text">自定义结果集: &lt;resultMap&gt;标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#联合查询"><span class="nav-number">3.7.</span> <span class="nav-text">联合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#association标签"><span class="nav-number">3.7.1.</span> <span class="nav-text">&lt;association&gt;标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#collection标签"><span class="nav-number">3.7.2.</span> <span class="nav-text">&lt;collection&gt;标签</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分步查询一般不用这种方式"><span class="nav-number">3.8.</span> <span class="nav-text">分步查询(一般不用这种方式)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#懒加载与按需查询"><span class="nav-number">3.8.1.</span> <span class="nav-text">懒加载与按需查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一般作法"><span class="nav-number">3.8.2.</span> <span class="nav-text">一般作法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#动态sql"><span class="nav-number">4.</span> <span class="nav-text">动态SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实验1"><span class="nav-number">4.1.</span> <span class="nav-text">实验1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实验2"><span class="nav-number">4.2.</span> <span class="nav-text">实验2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实验3"><span class="nav-number">4.3.</span> <span class="nav-text">实验3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实验4抽取可重用sql"><span class="nav-number">4.4.</span> <span class="nav-text">实验4：抽取可重用SQL</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mybatis缓存"><span class="nav-number">5.</span> <span class="nav-text">MyBatis缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一级缓存"><span class="nav-number">5.1.</span> <span class="nav-text">一级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一级缓存失效"><span class="nav-number">5.1.1.</span> <span class="nav-text">一级缓存失效</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二级缓存"><span class="nav-number">5.2.</span> <span class="nav-text">二级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用方法"><span class="nav-number">5.2.1.</span> <span class="nav-text">使用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询顺序"><span class="nav-number">5.2.2.</span> <span class="nav-text">查询顺序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#标签中关于缓存的属性"><span class="nav-number">5.3.</span> <span class="nav-text">标签中关于缓存的属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用第三方缓存"><span class="nav-number">5.4.</span> <span class="nav-text">使用第三方缓存</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#与spring的整合"><span class="nav-number">6.</span> <span class="nav-text">与Spring的整合</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="嘴强黑铁"
      src="/images/touxiang.jpg">
  <p class="site-author-name" itemprop="name">嘴强黑铁</p>
  <div class="site-description" itemprop="description">一顿操作猛如虎</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">103</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">110</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">嘴强黑铁</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.2
  </div>

        
<div class="busuanzi-count">
  <script pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      script.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  



  <script pjax>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : 24025,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://zuiqiangiron.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://www.zuiqiangiron.xyz/2020/07/08/MyBatis%E7%AC%94%E8%AE%B0/";
    this.page.identifier = "2020/07/08/MyBatis笔记/";
    this.page.title = "MyBatis笔记";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://zuiqiangiron.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

    </div>
</body>
</html>
